<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Agenda">
    <meta name="author" content="e-ghost 2019">

    <title>AgendaVue</title>

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/freelancer.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
</head>

<body id="page-top" class="index">

<div id="app"></div>

<script type="text/x-template" id="app-template">
    <div>
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header page-scroll">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Cambiar navegación</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#page-top">AgendaVue</a>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="hidden">
                            <a href="#page-top"></a>
                        </li>
                        <li class="page-scroll">
                            <a href="#contactos">Contactos</a>
                        </li>
                        <li class="page-scroll">
                            <a href="#nuevo">Añadir contacto</a>
                        </li>
                        <li class="page-scroll">
                            <a href="#about">Acerca de...</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <header>
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="intro-text">
                            <span class="name">AgendaVue</span>
                            <hr class="star-light">
                            <span class="skills">Agenda básica en Vue</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <section id="contactos">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 text-center">
                        <h2>Contactos</h2>
                        <hr class="star-primary">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-xs-4"><h4>Nombre</h4></div>
                    <div class="col-xs-4"><h4>Email</h4></div>
                    <div class="col-xs-3"><h4>Teléfono</h4></div>
                </div>

                <div class="row" v-for="contacto in contactos" v-bind:key="contacto.id">
                    <div class="col-xs-4">
                        <p>{{ contacto.nombre }}</p>
                    </div>
                    <div class="col-xs-4">
                        <p>{{ contacto.email }}</p>
                    </div>
                    <div class="col-xs-3">
                        <p>{{ contacto.telefono }}</p>
                    </div>
                    <div class="col-xs-1">
                        <button class="btn btn-danger btn-sm" v-on:click="borrarContacto(contacto.id)">
                            <span class="glyphicon glyphicon-remove"></span>
                        </button>
                    </div>
                </div>

                <div v-if="contactos.length === 0">
                    <div class="row">
                        <div class="col-xs-12">
                            <p>No se ha encontrado ningún contacto.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="nuevo">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 text-center">
                        <h2>Añadir contacto</h2>
                        <hr class="star-primary">
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                        <form name="sentMessage" id="contactForm" novalidate>
                            <div class="row control-group">
                                <div class="form-group col-xs-12 floating-label-form-group controls">
                                    <label>Nombre</label>
                                    <input type="text" class="form-control" placeholder="Nombre" id="name" v-model="nuevoContacto.nombre">
                                </div>
                            </div>
                            <div class="row control-group">
                                <div class="form-group col-xs-12 floating-label-form-group controls">
                                    <label>Email</label>
                                    <input type="email" class="form-control" placeholder="Email" id="email" v-model="nuevoContacto.email">
                                </div>
                            </div>
                            <div class="row control-group">
                                <div class="form-group col-xs-12 floating-label-form-group controls">
                                    <label>Teléfono</label>
                                    <input type="tel" class="form-control" placeholder="Número de teléfono" id="phone" v-model="nuevoContacto.telefono">
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="form-group col-xs-12">
                                    <button type="submit" class="btn btn-success btn-lg" v-on:click.prevent="agregarContacto">Añadir</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <section class="success" id="about">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 text-center">
                        <h2>Acerca de...</h2>
                        <hr class="star-light">
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12 text-center">
                        <p>AgendaVue es un proyecto simple en VueJS.</p>
                    </div>
                </div>
            </div>
        </section>

        <footer class="text-center">
            <div class="footer-above">
                <div class="container"></div>
            </div>
            <div class="footer-below">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            Copyleft &copy; e-ghost 2019
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</script>

<div class="scroll-top page-scroll visible-xs visible-sm">
    <a class="btn btn-primary" href="#page-top">
        <i class="fa fa-chevron-up"></i>
    </a>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>
  window.process = { env: { NODE_ENV: 'development' } }
</script>
<script type="importmap">
  {
    "imports": {
      "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js",
      "vue-demi": "https://unpkg.com/vue-demi/lib/index.mjs",
      "vuefire": "https://unpkg.com/vuefire@3.1.23/dist/index.mjs",
      "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
      "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js",
      "firebase/database": "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js",
      "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
      "firebase/storage": "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js",
      "firebase/functions": "https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js",
      "firebase/analytics": "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js",
      "firebase/app-check": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app-check.js",
      "firebase/remote-config": "https://www.gstatic.com/firebasejs/10.7.1/firebase-remote-config.js",
      "firebase/messaging": "https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js"
    }
  }
</script>

<script type="module">
  import { createApp, ref } from 'vue';
  import { useCollection, VueFire, VueFireAuth } from 'vuefire';
  import { initializeApp } from 'firebase/app';
  import { getFirestore, collection, addDoc, doc, deleteDoc } from 'firebase/firestore';

  const firebaseConfig = {
    apiKey: "AIzaSyC-24qX3xWd-Jvq6MTFhIvfbaOD9hedSbU",
    authDomain: "proyectoingeneriaweb2.firebaseapp.com",
    projectId: "proyectoingeneriaweb2",
    storageBucket: "proyectoingeneriaweb2.firebasestorage.app",
    messagingSenderId: "474442710152",
    appId: "1:474442710152:web:ba026d14488f377235733d",
    measurementId: "G-QEH663N8DS"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const myApp = createApp({
    template: '#app-template',
    setup() {
      const contactos = useCollection(collection(db, 'agenda'));

      const nuevoContacto = ref({
        nombre: '',
        email: '',
        telefono: ''
      });
      
      function agregarContacto() {
        if (nuevoContacto.value.nombre) {
          addDoc(collection(db, 'agenda'), { 
            nombre: nuevoContacto.value.nombre,
            email: nuevoContacto.value.email,
            telefono: nuevoContacto.value.telefono
           });
          
          nuevoContacto.value = { nombre: '', email: '', telefono: '' }; 
        } else {
            alert("Escribe al menos un nombre");
        }
      }

      function borrarContacto(id) {
          deleteDoc(doc(db, 'agenda', id));
      }

      return { contactos, nuevoContacto, agregarContacto, borrarContacto };
    }
  });

  myApp.use(VueFire, { firebaseApp: app });
  myApp.mount('#app');
</script>

</body>
</html>